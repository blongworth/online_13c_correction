---
title: "Online 13C Correction"
output:
  html_document:
    df_print: paged
---

Use raw OX-I data to assess online 13C correction effect on precision and accuracy over time and between systems.


```{r}
library(tidyverse)
library(amstools)
```

Collect data. Start with one wheel.

```{r}
data <- getRawWheel("USAMS112219") %>%
  filter(sample_type == "S") %>%
  mutate(norm1412 = he14_12/mean(he14_12),
         normcor1412 = corr_14_12/mean(corr_14_12))

data %>% 
  ggplot(aes(x = he12c)) +
    geom_point(aes(y = he14_12), color = "blue") +
    geom_point(aes(y = corr_14_12), color = "red") 
    
data %>% 
  ggplot(aes(x = he12c)) +
    geom_point(aes(y = norm1412), color = "blue") +
    geom_point(aes(y = normcor1412), color = "red") 

data %>%
  summarize(mean1412 = mean(he14_12),
            sd1412 = sd(he14_12),
            sdn1412 = sd(norm1412),
            rsd1412 = rsd(he14_12),
            meancor1412 = mean(corr_14_12),
            sdcor1412 = sd(corr_14_12),
            sdncor1412 = sd(normcor1412),
            rsdcor1412 = rsd(corr_14_12))
           


```

Same for last 6 months, both systems.

```{r}
data <- getRawData("2019-05-01") %>%
  filter(sample_type == "S",
         grepl("OX-I/", sample_name)) %>%
  group_by(wheel) %>%
  mutate(system = str_sub(wheel, 1, 5),
         he12cp = ifelse(system == "USAMS", he12c/3, he12c),
         norm1412 = he14_12/mean(he14_12),
         normcor1412 = corr_14_12/mean(corr_14_12))


data %>%
  group_by(system) %>%
  summarize(mean1412 = mean(he14_12),
            sd1412 = sd(he14_12),
            sdn1412 = sd(norm1412),
            meancor1412 = mean(corr_14_12),
            sdcor1412 = sd(corr_14_12),
            sdncor1412 = sd(normcor1412))

data %>% 
  ggplot(aes(x = he12cp)) +
    geom_point(aes(y = norm1412), color = "blue", alpha = 0.2) +
    geom_point(aes(y = normcor1412), color = "red", alpha = 0.2) +
    facet_grid(rows = vars(system))
```

### USAMS before improvement

```{r}
data <- getRawData("2018-05-01", "2019-01-01") %>%
  filter(sample_type == "S",
         grepl("OX-I/", sample_name)) %>%
  group_by(wheel) %>%
  mutate(system = str_sub(wheel, 1, 5),
         he12cp = ifelse(system == "USAMS", he12c/3, he12c),
         norm1412 = he14_12/mean(he14_12),
         normcor1412 = corr_14_12/mean(corr_14_12)) %>%
  filter(norm1412 > .9)


data %>%
  group_by(system) %>%
  summarize(mean1412 = mean(he14_12),
            sd1412 = sd(he14_12),
            sdn1412 = sd(norm1412),
            meancor1412 = mean(corr_14_12),
            sdcor1412 = sd(corr_14_12),
            sdncor1412 = sd(normcor1412))

data %>% 
  ggplot(aes(x = he12cp)) +
    geom_point(aes(y = norm1412), color = "blue", alpha = 0.2) +
    geom_point(aes(y = normcor1412), color = "red", alpha = 0.2) +
    facet_grid(rows = vars(system))

data %>% 
```
```{r}

```

Get dataset with 14/12, 13/12, and online corrected 14/12. Offline correction shouldn't matter much for this unless there's pre-graphitization fractionation in OX-I.

Summarize: Is OX-I more precise with or without correction? How does this relate to current.

## Accuracy

For this we'll need normalized data for secondaries, and we'll need to back out 13C correction or renormalize to produce uncorrected values and correct offline.